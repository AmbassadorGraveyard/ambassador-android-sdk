dependencies:
  pre:
    - wget "https://services.gradle.org/distributions/gradle-2.9-bin.zip"; unzip gradle-2.9-bin.zip
    - echo y | android update sdk --no-ui --all --filter tool,extra-android-m2repository,extra-android-support,extra-google-google_play_services,extra-google-m2repository,android-23
    - echo y | android update sdk --no-ui --all --filter build-tools-23.0.2
    - curl -sL http://bit.ly/jpm4j >jpm4j.jar
    - sudo java -jar jpm4j.jar -g init
    - sudo jpm install com.codacy:codacy-coverage-reporter:assembly

test:
  # pre:
  #   - emulator -avd circleci-android22 -no-audio -no-window:
  #       background: true
  #       parallel: true
  override:
    - ./gradlew -p SDKTestApplication jacocoFullReport
    # - cp -r SDKTestApplication/AmbassadorSDK/build/outputs $CIRCLE_ARTIFACTS
    - cp -r SDKTestApplication/AmbassadorSDK/build/reports/jacoco/jacocoReport/* $CIRCLE_TEST_REPORTS
    - cp -r SDKTestApplication/AmbassadorSDK/build/reports/tests/debug/* $CIRCLE_TEST_REPORTS
    # - circle-android wait-for-boot
    # - sleep 30
    # - adb shell input keyevent 82
    # - ./gradlew -p SDKTestApplication connectedDebugAndroidTest -PpreDexEnable=false -Pcom.android.build.threadPoolSize=1 -Dorg.gradle.parallel=false -Dorg.gradle.jvmargs="-Xms512m -Xmx512m" -Dorg.gradle.daemon=false
    # - cp -r SDKTestApplication/AmbassadorSDK/build/outputs $CIRCLE_ARTIFACTS
    # - cp -r SDKTestApplication/AmbassadorSDK/build/outputs/androidTest-results/* $CIRCLE_TEST_REPORTS
  post:
    - codacy-coverage-reporter -l Java -r $CIRCLE_TEST_REPORTS/jacocoReport.xml