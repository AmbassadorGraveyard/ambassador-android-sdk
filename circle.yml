machine:
  environment:
    AWS_PROJECT_ARN: arn:aws:devicefarm:us-west-2:574715127331:project:0152898b-cd13-44b8-b59e-428ef967b4cd

dependencies:
 pre:
    - curl -sL http://bit.ly/jpm4j >jpm4j.jar
    - sudo java -jar jpm4j.jar -g init
    - sudo jpm install com.codacy:codacy-coverage-reporter:assembly
    - sudo pip install awscli

test:
  override:
    - ./gradlew -p ambassadorsdk jacocoReport
    - cp -r ambassadorsdk/build/reports/jacoco/jacocoReport/* $CIRCLE_TEST_REPORTS
    - cp -r ambassadorsdk/build/reports/tests/debug/* $CIRCLE_TEST_REPORTS
    - ./gradlew -p ambassadorsdk-demo assembleDebug
    - cp ./ambassadorsdk-demo/build/outputs/apk/ambassadorsdk-demo-debug.apk $CIRCLE_TEST_REPORTS
    - bash devicefarm.sh
  post:
    - codacy-coverage-reporter -l Java -r $CIRCLE_TEST_REPORTS/jacocoReport.xml
